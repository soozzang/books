# ✍🏻 09. IO에서 발생하는 병목 현상
## 기본적인 IO는 이렇게 처리한다
자바에서 입력과 출력은 스트림을 통해서 이루어진다.

일반적으로 IO라고하면 파일 IO만을 생각할 수 있는데, 어떤 디바이스를 통해 이뤄지는 작업을 모두 IO라고 한다.

네트워크를 통해 다른 서버로 데이터를 전송하거나, 다른 서버로 부터 데이터를 전송 받는 것도 IO에 포함된다. 여러분이 간단하게 콘솔에 출력하는 것도 스트림을 통해서 출력하는 것이다.

참고로 IO는 성능에 영향을 가장 많이 미친다. IO에서 발생하는 시간은 CPU를 사용하는 시간과 대기 시간 중 대기 시간에 속하기 때문이다.

개발된 애플리케이션에서 IO를 사용했을 때, IO와 관련된 디바이스가 느리면 느릴수록 애플리케이션의 속도는 느려진다. 

자바에서 파일을 읽고 처리하는 방법은 굉장히 많다. java.io 소속의 스트림 클래스에 대해 간단히 리뷰하자.

스트림을 읽는 데 관련된 주요 클래스는 다음과 같다.

여기에 명시된 모든 입력과 관련된 스트림들은 java.io.InputStream 클래스로부터 상속받았다. 

바이트 기반의 스트림 입력을 처리하기 위해선 이 클래스의 하위 클래스를 사용한다.

- ByteArrayInputStream : 바이트로 구성된 배열을 읽어서 입력 스트림을 만든다.
- FileInputStream : 미이지와 같은 바이너리 기반의 파일의 스트림을 만든다.
- ObjectInputStream : ObjectOutputStream을 통해 저장해 놓은 객체를 읽기 위한 스트림을 만든다.

문자열 기반의 스트림을 읽기 위해서 사용하는 클래스는 이와 다르게 java.io.Reader 클래스의 하위 클래스들이다.
- BufferedReader : 문자열 입력 스트림을 버퍼에 담아 처리한다. 일반적으로 문자열 기반 파일을 읽을 때 가장 많이 사용된다.
- CharArrayReader : char의 배열로 된 문자 배열을 처리한다.
- FilterReader : 문자열 기반 스트림을 처리하기 위한 추상 클래스이다.
- FileReader : 문자열 기반의 파일을 읽기 위한 클래스이다.
- InputStreamReader : 바이트 깁나의 스트림을 문자열 기반의 스트림으로 연결하는 역할을 수행한다.

바이트 단위로 읽거나, 문자열 단위로 읽을 때 중요한건 한 번 연(open한) 스트림은 반드시 닫아 주어야 한다는 것이다.

스트림을 닫지 않으면 나중에 리소스가 부족해질 수 있다.

예를들어 파일을 열지 못하는 경우가 발생하면, 관련된 파일을 관리하는 스트림의 상태 변경이 불가능해지기 때문이다.

BufferdReader 클래스는 다른 FileReader 클래스와 마찬가지로 문자열 단위나 문자열 배열 단위로 읽을 수 있는 기능을 제공하지만, 추가로 라인 단위로 읽을 수 있는 readLine() 메서드를 제공한다.

## NIO의 원리는 어떻게 되는 거지?
JDK 1.4부터 추가된 NIO가 어떤 것인지 알아보자.

NIO가 무엇인지 자세하게 알기 위해선 근본적으로 IO 작업이 운영체제에서 어떻게 수행되었는지를 알아야 한다.

만약 여러분이 자바를 사용하여 하드 디스크에 있는 데이터를 읽는다면 어떤 프로세스로 진행이 될까?

1) 여러분이 파일을 읽으라는 메서드를 자바에 전달한다.
2) 파일명을 전달받은 메서드가 운영체제의 커널에게 파일을 읽어 달라고 요청한다.
3) 커널이 하드 디스크로부터 파일을 읽어서 자신의 커널에 있는 버퍼에 복사하는 작업을 수행한다. 
4) 자바에서는 마음대로 커널의 버퍼를 사용하지 못하므로, JVM으로 그 데이터를 전달한다.
5) JVM에서 메서드에 있는 스트림 관리 클래스를 사용하여 데이터를 처리한다.

자바에선 3번 복사작업을 할 때에나 4번 전달 작업을 수행할 때 대기하는 시간이 발생할 수 밖에 없다.

이러한 단점을 보완하기 위해서 NIO가 탄생했다.

3번 작업을 자바에서 직접 통제하여 시간을 더 단축할 수 있게 한것이다.

NIO를 사용한다고 IO에서 발생하는 모든 병목 현상이 해결되는 것은 아니지만, IO를 위한 여러 가지 새로운 개념이 도입되었다. 추가된 개념들을 간단히 정리하면 다음과 같다.

- 버퍼의 도입
- 채널의 도입
- 문자열의 엔코더와 디코더 제공
- Perl 스타일의 정규 표현식에 기초한 패턴 매칭 방법 제공
- 파일을 잠그거나 메모리 매핑이 가능한 파일 인터페이스 제공
- 서버를 위한 복합적인 Non-blocking IO 제공